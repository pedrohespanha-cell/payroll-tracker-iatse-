<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>873 Tracker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vue.js for State Management -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <!-- iOS Home Screen Setup -->
    <script>
        // Generate a custom iOS PNG icon instantly on load
        const canvas = document.createElement('canvas');
        canvas.width = 180;
        canvas.height = 180;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#4f46e5'; // Indigo background
        ctx.fillRect(0, 0, 180, 180);
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.font = '90px sans-serif';
        ctx.fillText('ðŸŽ¥', 90, 95); 
        
        const iconUrl = canvas.toDataURL('image/png');

        const addTag = (tag, attrs) => {
            const el = document.createElement(tag);
            Object.entries(attrs).forEach(([k, v]) => el.setAttribute(k, v));
            document.head.appendChild(el);
        };

        addTag('link', { rel: 'apple-touch-icon', href: iconUrl });
        addTag('meta', { name: 'apple-mobile-web-app-title', content: '873 Tracker' });
        addTag('meta', { name: 'apple-mobile-web-app-capable', content: 'yes' });
        addTag('meta', { name: 'apple-mobile-web-app-status-bar-style', content: 'black-translucent' });
    </script>
</head>
<body class="bg-slate-950 text-slate-200 font-sans selection:bg-indigo-500/30 pb-20 md:pb-0">
    <div id="app">
        <!-- Navigation -->
        <nav class="bg-slate-900 border-b border-slate-800 sticky top-0 z-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16 items-center">
                    <div class="flex items-center gap-3">
                        <div class="bg-indigo-600 p-2 rounded-lg">
                            <icon name="video" class-name="w-5 h-5 text-white"></icon>
                        </div>
                        <span class="font-bold text-xl tracking-tight text-white hidden sm:block">IATSE 873 Tracker</span>
                    </div>
                    <div class="flex gap-4">
                        <button @click="activeTab = 'dashboard'" :class="['flex items-center gap-2 px-3 py-2 rounded-md transition-colors', activeTab === 'dashboard' ? 'bg-slate-800 text-white' : 'text-slate-400 hover:text-white hover:bg-slate-800/50']">
                            <icon name="layout-dashboard" class-name="w-4 h-4"></icon>
                            <span class="hidden sm:inline">Dashboard</span>
                        </button>
                        <button @click="activeTab = 'scratchpad'" :class="['flex items-center gap-2 px-3 py-2 rounded-md transition-colors', activeTab === 'scratchpad' ? 'bg-slate-800 text-white' : 'text-slate-400 hover:text-white hover:bg-slate-800/50']">
                            <icon name="download" class-name="w-4 h-4"></icon>
                            <span class="hidden sm:inline">Auto-Import</span>
                        </button>
                        <button @click="activeTab = 'activity'" :class="['flex items-center gap-2 px-3 py-2 rounded-md transition-colors', activeTab === 'activity' ? 'bg-slate-800 text-white' : 'text-slate-400 hover:text-white hover:bg-slate-800/50']">
                            <icon name="history" class-name="w-4 h-4"></icon>
                            <span class="hidden sm:inline">Activity</span>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- Dashboard Tab -->
            <div v-if="activeTab === 'dashboard'" class="space-y-6">
                <!-- Stats Row -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <div v-for="(stat, i) in statCards" :key="i" class="bg-slate-900 border border-slate-800 rounded-xl p-4 flex items-center justify-between">
                        <div>
                            <p class="text-sm text-slate-400">{{ stat.label }}</p>
                            <p class="text-2xl font-bold text-white mt-1">{{ stat.value }}</p>
                        </div>
                        <div :class="['p-3 rounded-lg bg-slate-800/50', stat.color]">
                            <icon :name="stat.icon" class-name="w-6 h-6"></icon>
                        </div>
                    </div>
                </div>

                <!-- Controls Row -->
                <div class="bg-slate-900 p-4 rounded-xl border border-slate-800 space-y-4">
                    <div class="flex flex-col md:flex-row gap-4 justify-between items-start md:items-center">
                        <div class="flex-1 w-full relative">
                            <icon name="search" class-name="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></icon>
                            <input type="text" placeholder="Search shows, gaffers, company..." v-model="searchQuery" class="w-full bg-slate-950 border border-slate-700 text-white rounded-lg pl-10 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all" />
                        </div>
                        <button @click="handleOpenModal()" class="flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap w-full md:w-auto">
                            <icon name="plus" class-name="w-4 h-4"></icon>
                            <span>Add Show</span>
                        </button>
                    </div>

                    <!-- Advanced Filters -->
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div class="relative">
                            <icon name="filter" class-name="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></icon>
                            <select v-model="statusFilter" class="w-full bg-slate-950 border border-slate-700 text-white rounded-lg pl-10 pr-8 py-2 appearance-none focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all text-sm">
                                <option value="All">All Statuses</option>
                                <option value="Upcoming">Upcoming</option>
                                <option value="Prep">Prep</option>
                                <option value="Shooting">Shooting</option>
                                <option value="Wrapped">Wrapped</option>
                                <option value="Rumoured">Rumoured</option>
                            </select>
                        </div>
                        <div class="relative">
                            <icon name="filter" class-name="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></icon>
                            <select v-model="gafferFilter" class="w-full bg-slate-950 border border-slate-700 text-white rounded-lg pl-10 pr-8 py-2 appearance-none focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all text-sm">
                                <option value="All">All Gaffers</option>
                                <option v-for="g in uniqueGaffers" :key="g" :value="g">{{ g }}</option>
                            </select>
                        </div>
                        <div class="relative">
                            <icon name="filter" class-name="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></icon>
                            <select v-model="rigGafferFilter" class="w-full bg-slate-950 border border-slate-700 text-white rounded-lg pl-10 pr-8 py-2 appearance-none focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all text-sm">
                                <option value="All">All Rigging Gaffers</option>
                                <option v-for="rg in uniqueRigGaffers" :key="rg" :value="rg">{{ rg }}</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Mobile View (Cards) -->
                <div class="md:hidden space-y-4">
                    <div v-if="filteredAndSortedProductions.length === 0" class="bg-slate-900 border border-slate-800 rounded-xl p-8 text-center text-slate-500">
                        No productions found matching your criteria.
                    </div>
                    <div v-else v-for="prod in filteredAndSortedProductions" :key="prod.id" class="bg-slate-900 border border-slate-800 rounded-xl p-4 flex flex-col gap-3 shadow-sm">
                        <div class="flex justify-between items-start gap-4">
                            <div>
                                <button @click="viewingProd = prod" class="font-bold text-indigo-400 hover:text-indigo-300 transition-colors text-left text-lg leading-tight">
                                    {{ prod.name }}
                                </button>
                                <div v-if="prod.rate" class="flex items-center gap-1 text-xs text-emerald-400 mt-1.5 font-medium">
                                    <icon name="dollar-sign" class-name="w-3.5 h-3.5"></icon> {{ prod.rate }}
                                </div>
                            </div>
                            <span :class="['shrink-0 px-2.5 py-1 rounded-full text-xs font-medium border', getStatusColor(prod.status)]">
                                {{ prod.status }}
                            </span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="bg-slate-950 p-2 rounded-lg border border-slate-800/50">
                                <span class="block text-[10px] uppercase tracking-wider text-slate-500 mb-0.5">Gaffer</span>
                                <span class="text-slate-200 line-clamp-1" :title="prod.gaffer">{{ prod.gaffer || 'â€”' }}</span>
                            </div>
                            <div class="bg-slate-950 p-2 rounded-lg border border-slate-800/50">
                                <span class="block text-[10px] uppercase tracking-wider text-slate-500 mb-0.5">Rigging Gaffer</span>
                                <span class="text-slate-200 line-clamp-1" :title="prod.riggingGaffer">{{ prod.riggingGaffer || 'â€”' }}</span>
                            </div>
                        </div>

                        <div class="flex items-center justify-between border-t border-slate-800 pt-3 mt-1">
                            <div class="text-xs text-slate-400 flex items-center gap-1.5">
                                <icon name="calendar" class-name="w-3.5 h-3.5 shrink-0"></icon>
                                <span class="line-clamp-1">{{ prod.startDate || 'TBD' }} <span class="text-slate-600 mx-0.5">â†’</span> {{ prod.endDate || 'TBD' }}</span>
                            </div>
                            <div class="flex items-center gap-2 shrink-0">
                                <button @click="viewingProd = prod" class="p-1.5 text-slate-400 hover:text-indigo-400 bg-slate-950 border border-slate-800 hover:bg-indigo-400/10 rounded-md transition-colors"><icon name="eye" class-name="w-4 h-4"></icon></button>
                                <button @click="handleOpenModal(prod)" class="p-1.5 text-slate-400 hover:text-white bg-slate-950 border border-slate-800 hover:bg-slate-800 rounded-md transition-colors"><icon name="edit" class-name="w-4 h-4"></icon></button>
                                <button @click="handleDelete(prod.id)" class="p-1.5 text-slate-400 hover:text-red-400 bg-slate-950 border border-slate-800 hover:bg-red-400/10 rounded-md transition-colors"><icon name="trash-2" class-name="w-4 h-4"></icon></button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Table (Desktop View) -->
                <div class="hidden md:block bg-slate-900 border border-slate-800 rounded-xl overflow-hidden shadow-lg">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-slate-950/50 border-b border-slate-800">
                                    <th class="px-6 py-4 text-sm font-semibold text-slate-300 cursor-pointer hover:bg-slate-800/50 select-none" @click="handleSort('name')">
                                        Show Name <icon v-if="sortConfig.key === 'name'" :name="sortConfig.direction === 'asc' ? 'chevron-up' : 'chevron-down'" class-name="w-4 h-4 inline-block ml-1 text-indigo-400"></icon>
                                    </th>
                                    <th class="px-6 py-4 text-sm font-semibold text-slate-300 cursor-pointer hover:bg-slate-800/50 select-none" @click="handleSort('status')">
                                        Status <icon v-if="sortConfig.key === 'status'" :name="sortConfig.direction === 'asc' ? 'chevron-up' : 'chevron-down'" class-name="w-4 h-4 inline-block ml-1 text-indigo-400"></icon>
                                    </th>
                                    <th class="px-6 py-4 text-sm font-semibold text-slate-300 cursor-pointer hover:bg-slate-800/50 select-none" @click="handleSort('gaffer')">
                                        Gaffer <icon v-if="sortConfig.key === 'gaffer'" :name="sortConfig.direction === 'asc' ? 'chevron-up' : 'chevron-down'" class-name="w-4 h-4 inline-block ml-1 text-indigo-400"></icon>
                                    </th>
                                    <th class="px-6 py-4 text-sm font-semibold text-slate-300 cursor-pointer hover:bg-slate-800/50 select-none" @click="handleSort('startDate')">
                                        Start Date <icon v-if="sortConfig.key === 'startDate'" :name="sortConfig.direction === 'asc' ? 'chevron-up' : 'chevron-down'" class-name="w-4 h-4 inline-block ml-1 text-indigo-400"></icon>
                                    </th>
                                    <th class="px-6 py-4 text-sm font-semibold text-slate-300 cursor-pointer hover:bg-slate-800/50 select-none" @click="handleSort('endDate')">
                                        End Date <icon v-if="sortConfig.key === 'endDate'" :name="sortConfig.direction === 'asc' ? 'chevron-up' : 'chevron-down'" class-name="w-4 h-4 inline-block ml-1 text-indigo-400"></icon>
                                    </th>
                                    <th class="px-6 py-4 text-sm font-semibold text-slate-300 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-800/50">
                                <tr v-if="filteredAndSortedProductions.length === 0">
                                    <td colspan="6" class="px-6 py-12 text-center text-slate-500">
                                        No productions found matching your criteria.
                                    </td>
                                </tr>
                                <tr v-for="prod in filteredAndSortedProductions" :key="prod.id" class="hover:bg-slate-800/30 transition-colors group">
                                    <td class="px-6 py-4">
                                        <button @click="viewingProd = prod" class="font-medium text-indigo-400 hover:text-indigo-300 transition-colors text-left">
                                            {{ prod.name }}
                                        </button>
                                        <div v-if="prod.rate" class="flex items-center gap-1 text-xs text-emerald-400 mt-1">
                                            <icon name="dollar-sign" class-name="w-3 h-3"></icon> {{ prod.rate }}
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <span :class="['px-2.5 py-1 rounded-full text-xs font-medium border', getStatusColor(prod.status)]">
                                            {{ prod.status }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-slate-300">
                                        <div>{{ prod.gaffer || 'â€”' }}</div>
                                        <div class="text-xs text-slate-500 mt-0.5">Rig: {{ prod.riggingGaffer || 'â€”' }}</div>
                                    </td>
                                    <td class="px-6 py-4 text-slate-400 text-sm whitespace-nowrap">{{ prod.startDate || 'â€”' }}</td>
                                    <td class="px-6 py-4 text-slate-400 text-sm whitespace-nowrap">{{ prod.endDate || 'â€”' }}</td>
                                    <td class="px-6 py-4 text-right">
                                        <div class="flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button @click="viewingProd = prod" class="p-2 text-slate-400 hover:text-indigo-400 hover:bg-indigo-400/10 rounded-md transition-colors" title="View Details"><icon name="eye" class-name="w-4 h-4"></icon></button>
                                            <button @click="handleOpenModal(prod)" class="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-colors" title="Edit"><icon name="edit" class-name="w-4 h-4"></icon></button>
                                            <button @click="handleDelete(prod.id)" class="p-2 text-slate-400 hover:text-red-400 hover:bg-red-400/10 rounded-md transition-colors" title="Delete"><icon name="trash-2" class-name="w-4 h-4"></icon></button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Scratchpad Tab -->
            <div v-if="activeTab === 'scratchpad'" class="grid grid-cols-1 lg:grid-cols-2 gap-6 min-h-[calc(100vh-12rem)]">
                <div class="bg-slate-900 border border-slate-800 rounded-xl p-4 flex flex-col h-full">
                    <div class="mb-4">
                        <h2 class="text-lg font-bold text-white flex items-center gap-2">
                            <icon name="download" class-name="w-5 h-5 text-indigo-400"></icon>
                            Auto-Import from HTML
                        </h2>
                        <p class="text-sm text-slate-400 mt-1">Right-click on the IATSE 873 Current Productions page, click <strong>"View Page Source"</strong>, copy all the HTML text, and paste it here.</p>
                    </div>
                    <textarea v-model="scratchpadText" placeholder="Paste raw HTML source code here..." class="flex-1 bg-slate-950 border border-slate-700 text-slate-300 rounded-lg p-4 resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500 font-mono text-sm leading-relaxed mb-4 min-h-[250px]"></textarea>
                    <button @click="handleParseHTML" :disabled="!scratchpadText.trim()" class="w-full bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-medium py-3 rounded-lg transition-colors">
                        Auto-Extract Productions
                    </button>
                    
                    <div v-if="parseMessage" :class="['mt-4 p-3 rounded-lg text-sm border', parseMessage.type === 'success' ? 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20' : 'bg-red-500/10 text-red-400 border-red-500/20']">
                        {{ parseMessage.text }}
                    </div>
                </div>
                
                <div class="bg-slate-900 border border-slate-800 rounded-xl p-4 flex flex-col h-full overflow-y-auto">
                    <div class="mb-6 flex justify-between items-center">
                        <h2 class="text-lg font-bold text-white flex items-center gap-2">
                            <icon name="plus" class-name="w-5 h-5 text-indigo-400"></icon>
                            Quick Add
                        </h2>
                    </div>
                    <form @submit.prevent="handleSave" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">Show Name</label>
                            <input type="text" required v-model="formData.name" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">Status</label>
                            <select v-model="formData.status" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                <option value="Upcoming">Upcoming</option>
                                <option value="Prep">Prep</option>
                                <option value="Shooting">Shooting</option>
                                <option value="Wrapped">Wrapped</option>
                                <option value="Rumoured">Rumoured</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-1">Gaffer</label>
                                <input type="text" v-model="formData.gaffer" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-1">Rigging Gaffer</label>
                                <input type="text" v-model="formData.riggingGaffer" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-1">Start Date</label>
                                <input type="text" v-model="formData.startDate" placeholder="e.g. Jan 01 2026" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-1">End Date</label>
                                <input type="text" v-model="formData.endDate" placeholder="e.g. Mar 15 2026" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-1">
                                <label class="block text-sm font-medium text-slate-300 mb-1">Pay Rate / Tier</label>
                                <input type="text" v-model="formData.rate" placeholder="e.g. Tier A" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-emerald-400 focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                            </div>
                            <div class="col-span-1">
                                <label class="block text-sm font-medium text-slate-300 mb-1">Company</label>
                                <input type="text" v-model="formData.company" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 rounded-lg transition-colors mt-4">
                            Save Tracker
                        </button>
                    </form>
                </div>
            </div>

            <!-- Activity Tab -->
            <div v-if="activeTab === 'activity'" class="bg-slate-900 border border-slate-800 rounded-xl p-6 min-h-[calc(100vh-12rem)]">
                <div class="mb-6 flex items-center gap-2">
                    <icon name="history" class-name="w-6 h-6 text-indigo-400"></icon>
                    <h2 class="text-xl font-bold text-white">Activity Log</h2>
                </div>
                
                <div v-if="activityLog.length === 0" class="text-center py-12 text-slate-500">
                    <icon name="clock" class-name="w-12 h-12 mx-auto mb-4 opacity-20"></icon>
                    <p>No recent activity. Changes you make will appear here.</p>
                </div>
                <div v-else class="space-y-4">
                    <div v-for="log in activityLog" :key="log.id" class="bg-slate-950 border border-slate-800 rounded-lg p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span :class="['px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wider', 
                                    (log.action === 'Added' || log.action === 'Imported') ? 'bg-emerald-500/20 text-emerald-400' :
                                    log.action === 'Deleted' ? 'bg-red-500/20 text-red-400' : 'bg-blue-500/20 text-blue-400']">
                                    {{ log.action }}
                                </span>
                                <span class="font-medium text-white">{{ log.target }}</span>
                            </div>
                            <p class="text-sm text-slate-400">{{ log.details }}</p>
                        </div>
                        <div class="text-xs text-slate-500 whitespace-nowrap flex items-center gap-1">
                            <icon name="clock" class-name="w-3 h-3"></icon>
                            {{ new Date(log.timestamp).toLocaleDateString() }} {{ new Date(log.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) }}
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Production Details Modal -->
        <div v-if="viewingProd" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50">
            <div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-lg shadow-2xl animate-in fade-in zoom-in-95 duration-200">
                <div class="flex justify-between items-center p-6 border-b border-slate-800">
                    <h2 class="text-xl font-bold text-white">{{ viewingProd.name }}</h2>
                    <button @click="viewingProd = null" class="text-slate-400 hover:text-white transition-colors">
                        <icon name="x" class-name="w-5 h-5"></icon>
                    </button>
                </div>
                <div class="p-6 space-y-4">
                    <div class="flex gap-2 items-center mb-6">
                        <span :class="['px-3 py-1 rounded-full text-xs font-medium border', getStatusColor(viewingProd.status)]">
                            {{ viewingProd.status }}
                        </span>
                        <span v-if="viewingProd.startDate || viewingProd.endDate" class="text-slate-300 text-sm font-medium flex items-center gap-1.5 bg-slate-800/50 px-3 py-1 rounded-full border border-slate-700">
                            <icon name="calendar" class-name="w-3.5 h-3.5 text-indigo-400"></icon>
                            {{ viewingProd.startDate || 'TBD' }} <span class="text-slate-500 mx-1">â†’</span> {{ viewingProd.endDate || 'TBD' }}
                        </span>
                        <span v-if="viewingProd.rate" class="text-emerald-400 text-sm font-medium flex items-center gap-1 bg-emerald-500/10 px-3 py-1 rounded-full border border-emerald-500/30 ml-auto">
                            <icon name="dollar-sign" class-name="w-3.5 h-3.5"></icon>
                            {{ viewingProd.rate }}
                        </span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 bg-slate-950 p-4 rounded-lg border border-slate-800">
                        <div>
                            <p class="text-xs text-slate-500 font-semibold uppercase tracking-wider mb-1">Gaffer</p>
                            <p class="text-white">{{ viewingProd.gaffer || 'N/A' }}</p>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500 font-semibold uppercase tracking-wider mb-1">Rigging Gaffer</p>
                            <p class="text-white">{{ viewingProd.riggingGaffer || 'N/A' }}</p>
                        </div>
                    </div>

                    <div class="space-y-3 pt-2">
                        <div>
                            <p class="text-xs text-slate-500 font-semibold uppercase tracking-wider mb-1">Production Company / Studio</p>
                            <p class="text-slate-200">{{ viewingProd.company || 'â€”' }}</p>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500 font-semibold uppercase tracking-wider mb-1">Address</p>
                            <p class="text-slate-200">{{ viewingProd.address || 'â€”' }}</p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-slate-500 font-semibold uppercase tracking-wider mb-1">Phone</p>
                                <p class="text-slate-200">{{ viewingProd.phone || 'â€”' }}</p>
                            </div>
                            <div>
                                <p class="text-xs text-slate-500 font-semibold uppercase tracking-wider mb-1">Email</p>
                                <a :href="'mailto:' + viewingProd.email" class="text-indigo-400 hover:text-indigo-300 break-all">{{ viewingProd.email || 'â€”' }}</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add/Edit Modal -->
        <div v-if="isModalOpen" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto">
            <div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-md shadow-2xl my-8">
                <div class="flex justify-between items-center p-6 border-b border-slate-800 sticky top-0 bg-slate-900 rounded-t-2xl z-10">
                    <h2 class="text-xl font-bold text-white">{{ editingId ? 'Edit Production' : 'Add New Production' }}</h2>
                    <button @click="handleCloseModal" class="text-slate-400 hover:text-white transition-colors">
                        <icon name="x" class-name="w-5 h-5"></icon>
                    </button>
                </div>
                <form @submit.prevent="handleSave" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Show Name</label>
                        <input type="text" required v-model="formData.name" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">Status</label>
                            <select v-model="formData.status" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                <option value="Upcoming">Upcoming</option>
                                <option value="Prep">Prep</option>
                                <option value="Shooting">Shooting</option>
                                <option value="Wrapped">Wrapped</option>
                                <option value="Rumoured">Rumoured</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1 flex items-center gap-1"><icon name="dollar-sign" class-name="w-3.5 h-3.5 text-emerald-400"></icon> Rate / Tier</label>
                            <input type="text" v-model="formData.rate" placeholder="e.g. Tier A" class="w-full bg-slate-950 border border-emerald-500/50 rounded-lg px-4 py-2 text-emerald-400 focus:ring-2 focus:ring-emerald-500 focus:outline-none" />
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">Gaffer</label>
                            <input type="text" v-model="formData.gaffer" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">Rigging Gaffer</label>
                            <input type="text" v-model="formData.riggingGaffer" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">Start Date</label>
                            <input type="text" v-model="formData.startDate" placeholder="e.g. Jan 01 2026" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">End Date</label>
                            <input type="text" v-model="formData.endDate" placeholder="e.g. Mar 15 2026" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                        </div>
                    </div>
                    <div class="border-t border-slate-800 pt-4 mt-2">
                        <h3 class="text-sm font-semibold text-slate-400 mb-3 uppercase tracking-wider">Contact Details</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-1">Company / Studio</label>
                                <input type="text" v-model="formData.company" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-1">Address</label>
                                <input type="text" v-model="formData.address" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-1">Phone</label>
                                    <input type="text" v-model="formData.phone" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-1">Email</label>
                                    <input type="email" v-model="formData.email" class="w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pt-4 flex gap-3">
                        <button type="button" @click="handleCloseModal" class="flex-1 bg-slate-800 hover:bg-slate-700 text-white font-medium py-2.5 rounded-lg transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 rounded-lg transition-colors">
                            {{ editingId ? 'Save Changes' : 'Add Production' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Application Logic -->
    <script>
        const initialProductions = [
            { id: '1', name: 'The Body, Season 1', status: 'Shooting', gaffer: 'Chris Harmsworth', riggingGaffer: 'Sean Anicic', startDate: 'Oct 06 2025', endDate: 'Feb 21 2026', notes: '', company: 'Cold Dish Productions ULC / Netflix', address: '2365 Dixie Rd., Mississauga L4Y 0E6 Canada', phone: 'P 905-270-7488', email: 'thebodyprodoffice@gmail.com', rate: '' },
            { id: '2', name: 'Boston Blue, Season 1', status: 'Shooting', gaffer: 'Sami Hajjar', riggingGaffer: 'Nigel Hartwell', startDate: 'Jul 10 2025', endDate: 'Mar 06 2026', notes: '', company: 'LS Productions Inc. / CBS', address: '6200 Cantay Rd., Mississauga L5R 3Y9 Canada', phone: 'P 416-487-3213', email: 'bostonblue.prod@mount22prod.com', rate: '' },
            { id: '3', name: 'Brilliant Minds, Season 2', status: 'Shooting', gaffer: 'Michael Armstrong', riggingGaffer: 'Elder Gomes', startDate: 'Jul 02 2025', endDate: 'Mar 06 2026', notes: '', company: 'Ambleside Productions Services Inc. / Warner Bros.', address: '6110 Cantay Rd., Mississauga L5R 4J8 Canada', phone: 'P 647-925-1410', email: 'productions2bm@gmail.com', rate: '' }
        ];

        // SVG Icon Library
        const iconPaths = {
            'video': '<path d="m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"/><rect x="2" y="6" width="14" height="12" rx="2"/>',
            'check-circle': '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/>',
            'calendar': '<path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/>',
            'file-text': '<path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/>',
            'layout-dashboard': '<rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/>',
            'download': '<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>',
            'history': '<path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/>',
            'clock': '<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>',
            'dollar-sign': '<line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>',
            'search': '<circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>',
            'filter': '<polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>',
            'plus': '<path d="M5 12h14"/><path d="M12 5v14"/>',
            'edit': '<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>',
            'trash-2': '<path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/>',
            'eye': '<path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/>',
            'chevron-up': '<path d="m18 15-6-6-6 6"/>',
            'chevron-down': '<path d="m6 9 6 6 6-6"/>',
            'x': '<path d="M18 6 6 18"/><path d="m6 6 12 12"/>'
        };

        const app = Vue.createApp({
            data() {
                let savedProds = initialProductions;
                let savedLogs = [];
                try {
                    const localProds = localStorage.getItem('iatse_productions');
                    if (localProds) savedProds = JSON.parse(localProds);
                    const localLogs = localStorage.getItem('iatse_activity');
                    if (localLogs) savedLogs = JSON.parse(localLogs);
                } catch (e) { console.error("LocalStorage error", e); }

                return {
                    productions: savedProds,
                    activityLog: savedLogs,
                    searchQuery: '',
                    statusFilter: 'All',
                    gafferFilter: 'All',
                    rigGafferFilter: 'All',
                    sortConfig: { key: 'name', direction: 'asc' },
                    activeTab: 'dashboard',
                    isModalOpen: false,
                    viewingProd: null,
                    editingId: null,
                    scratchpadText: '',
                    parseMessage: null,
                    formData: this.getEmptyForm()
                };
            },
            watch: {
                productions: {
                    deep: true,
                    handler(newVal) {
                        localStorage.setItem('iatse_productions', JSON.stringify(newVal));
                    }
                },
                activityLog: {
                    deep: true,
                    handler(newVal) {
                        localStorage.setItem('iatse_activity', JSON.stringify(newVal));
                    }
                }
            },
            computed: {
                uniqueGaffers() {
                    const gaffers = new Set(this.productions.map(p => p.gaffer).filter(g => g && g !== 'N/A' && g !== 'TBD'));
                    return Array.from(gaffers).sort();
                },
                uniqueRigGaffers() {
                    const rGaffers = new Set(this.productions.map(p => p.riggingGaffer).filter(g => g && g !== 'N/A' && g !== 'TBD'));
                    return Array.from(rGaffers).sort();
                },
                stats() {
                    return {
                        total: this.productions.length,
                        shooting: this.productions.filter(p => p.status === 'Shooting').length,
                        upcoming: this.productions.filter(p => p.status === 'Upcoming').length,
                        prep: this.productions.filter(p => p.status === 'Prep').length,
                        rumoured: this.productions.filter(p => p.status === 'Rumoured').length,
                    };
                },
                statCards() {
                    return [
                        { label: 'Total Tracked', value: this.stats.total, icon: 'video', color: 'text-indigo-400' },
                        { label: 'Currently Shooting', value: this.stats.shooting, icon: 'check-circle', color: 'text-emerald-400' },
                        { label: 'In Prep', value: this.stats.prep, icon: 'calendar', color: 'text-amber-400' },
                        { label: 'Upcoming', value: this.stats.upcoming, icon: 'calendar', color: 'text-blue-400' },
                        { label: 'Rumoured', value: this.stats.rumoured, icon: 'file-text', color: 'text-purple-400' }
                    ];
                },
                filteredAndSortedProductions() {
                    let result = [...this.productions].filter(prod => {
                        const sq = this.searchQuery.toLowerCase();
                        const matchesSearch = 
                            (prod.name?.toLowerCase() || '').includes(sq) ||
                            (prod.gaffer?.toLowerCase() || '').includes(sq) ||
                            (prod.riggingGaffer?.toLowerCase() || '').includes(sq) ||
                            (prod.company?.toLowerCase() || '').includes(sq);
                        
                        const matchesStatus = this.statusFilter === 'All' || prod.status === this.statusFilter;
                        const matchesGaffer = this.gafferFilter === 'All' || prod.gaffer === this.gafferFilter;
                        const matchesRigGaffer = this.rigGafferFilter === 'All' || prod.riggingGaffer === this.rigGafferFilter;
                        
                        return matchesSearch && matchesStatus && matchesGaffer && matchesRigGaffer;
                    });

                    result.sort((a, b) => {
                        const key = this.sortConfig.key;
                        const dir = this.sortConfig.direction === 'asc' ? -1 : 1;
                        const invDir = this.sortConfig.direction === 'asc' ? 1 : -1;

                        if (key === 'startDate' || key === 'endDate') {
                            let dateA = a[key] ? new Date(a[key]).getTime() : 0;
                            let dateB = b[key] ? new Date(b[key]).getTime() : 0;
                            if (isNaN(dateA)) dateA = 0;
                            if (isNaN(dateB)) dateB = 0;

                            if (dateA === 0 && dateB === 0) {
                                let strA = (a[key] || '').toLowerCase();
                                let strB = (b[key] || '').toLowerCase();
                                if (strA < strB) return dir;
                                if (strA > strB) return invDir;
                                return 0;
                            }
                            if (dateA < dateB) return dir;
                            if (dateA > dateB) return invDir;
                            return 0;
                        }

                        let aValue = (a[key] || '').toLowerCase();
                        let bValue = (b[key] || '').toLowerCase();
                        if (aValue < bValue) return dir;
                        if (aValue > bValue) return invDir;
                        return 0;
                    });

                    return result;
                }
            },
            methods: {
                getEmptyForm() {
                    return { name: '', status: 'Upcoming', gaffer: '', riggingGaffer: '', startDate: '', endDate: '', notes: '', company: '', address: '', phone: '', email: '', rate: '' };
                },
                handleSort(key) {
                    let direction = 'asc';
                    if (this.sortConfig.key === key && this.sortConfig.direction === 'asc') direction = 'desc';
                    this.sortConfig = { key, direction };
                },
                logActivity(action, target, details) {
                    this.activityLog.unshift({
                        id: crypto.randomUUID(),
                        timestamp: new Date().toISOString(),
                        action, target, details
                    });
                },
                handleParseHTML() {
                    try {
                        const parser = new DOMParser();
                        const docParsed = parser.parseFromString(this.scratchpadText, 'text/html');
                        const items = docParsed.querySelectorAll('.accordion_current .item');

                        const newProductions = [];
                        const now = new Date();
                        let foundAny = false;

                        // 1. Current Productions
                        if (items.length > 0) {
                            foundAny = true;
                            items.forEach(item => {
                                const titleEl = item.querySelector('.current-production-title');
                                if (!titleEl) return;
                                let name = titleEl.textContent.trim();
                                let status = 'Shooting';
                                if (name.toUpperCase().startsWith('WRAPPED')) {
                                    status = 'Wrapped';
                                    name = name.replace(/^WRAPPED\s*-\s*/i, '').trim();
                                }

                                let gaffer = 'N/A', riggingGaffer = 'N/A';
                                const tds = item.querySelectorAll('td');
                                for (let i = 0; i < tds.length; i++) {
                                    const text = tds[i].textContent.trim();
                                    if (text === 'Gaffer' && tds[i+1]) gaffer = tds[i+1].textContent.trim().replace(/\n/g, '').replace(/\s{2,}/g, ' ');
                                    if (text === 'Rigging Gaffer' && tds[i+1]) riggingGaffer = tds[i+1].textContent.trim().replace(/\n/g, '').replace(/\s{2,}/g, ' ');
                                }

                                let company = '', address = '', phone = '', email = '';
                                const topContentTds = item.querySelectorAll('.table-headertop-content td');
                                if (topContentTds.length >= 5) {
                                    company = topContentTds[0]?.textContent.trim() || '';
                                    let add1 = topContentTds[1]?.textContent.trim() || '';
                                    let add2 = topContentTds[2]?.textContent.replace(/\n/g, ' ').replace(/\s+/g, ' ').trim() || '';
                                    address = `${add1}, ${add2}`.replace(/^,\s*/, '').replace(/,\s*$/, '');
                                    phone = topContentTds[3]?.textContent.trim() || '';
                                    email = topContentTds[4]?.textContent.trim().replace(/^E\s*/, '') || '';
                                }

                                let startDate = '', endDate = '';
                                const times = item.querySelectorAll('time.datetime');
                                if (times.length === 2) {
                                    const startD = new Date(times[0].getAttribute('datetime'));
                                    const endD = new Date(times[1].getAttribute('datetime'));
                                    startDate = times[0].textContent.trim();
                                    endDate = times[1].textContent.trim();
                                    if (status !== 'Wrapped') {
                                        if (now < startD) status = 'Upcoming';
                                        else if (now > endD) status = 'Wrapped';
                                    }
                                }

                                newProductions.push({ id: crypto.randomUUID(), name, status, gaffer, riggingGaffer, startDate, endDate, notes: '', company, address, phone, email, rate: '' });
                            });
                        }

                        // 2. Upcoming / Rumoured
                        const unescapedText = this.scratchpadText.replace(/\\n/g, '\n').replace(/\\"/g, '"').replace(/\\\//g, '/').replace(/\\u([\dA-F]{4})/gi, (m, g1) => String.fromCharCode(parseInt(g1, 16)));
                        const upcomingSplit = unescapedText.split(/UPCOMING\s*\/\s*RUMOURED\s*PRODUCTIONS/i);
                        
                        if (upcomingSplit.length > 1) {
                            const contentAfterHeader = upcomingSplit[1].split(/<h[1-6]|<script|<footer|<\/div>\s*<\/div>\s*<\/div>/i)[0];
                            let formattedText = contentAfterHeader.replace(/<br\s*\/?>/gi, '\n').replace(/<\/p>/gi, '\n').replace(/<\/li>/gi, '\n').replace(/<[^>]+>/g, '').replace(/&nbsp;/g, ' ');
                            const lines = formattedText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                            
                            lines.forEach(line => {
                                const lower = line.toLowerCase();
                                if (lower.includes('the following are') || lower.includes('subject to change') || lower.includes('all dates') || line.length < 4 || line.length > 200) return;

                                foundAny = true;
                                let name = line, dateString = '';
                                const separatorMatch = line.match(/\s+[-â€“â€”]\s+/);
                                if (separatorMatch) {
                                    const splitIndex = separatorMatch.index;
                                    name = line.substring(0, splitIndex).trim();
                                    dateString = line.substring(splitIndex + separatorMatch[0].length).trim();
                                }

                                let startDate = '', endDate = '';
                                if (dateString) {
                                    if (dateString.toLowerCase().includes(' to ')) {
                                        const parts = dateString.split(/\s+to\s+/i);
                                        startDate = parts[0].trim();
                                        endDate = parts[1].trim();
                                    } else {
                                        startDate = dateString;
                                    }
                                }

                                newProductions.push({ id: crypto.randomUUID(), name, status: 'Rumoured', gaffer: 'TBD', riggingGaffer: 'TBD', startDate, endDate, notes: '', company: 'TBD', address: '', phone: '', email: '', rate: '' });
                            });
                        }

                        if (!foundAny) {
                            this.parseMessage = { type: 'error', text: 'No productions found. Please ensure you pasted the raw HTML.' };
                            return;
                        }

                        const existingNames = new Set(this.productions.map(p => p.name.toLowerCase()));
                        const uniqueNewProductions = [];
                        
                        for (const p of newProductions) {
                            if (!existingNames.has(p.name.toLowerCase())) {
                                existingNames.add(p.name.toLowerCase());
                                uniqueNewProductions.push(p);
                            }
                        }

                        if (uniqueNewProductions.length > 0) {
                            this.logActivity('Imported', `${uniqueNewProductions.length} productions`, `Auto-imported: ${uniqueNewProductions.map(p => p.name).join(', ')}`);
                            this.parseMessage = { type: 'success', text: `Extracted ${newProductions.length} shows. Added ${uniqueNewProductions.length} new shows.` };
                            this.productions = [...this.productions, ...uniqueNewProductions];
                        } else {
                            this.parseMessage = { type: 'success', text: 'No new unique productions found to import.' };
                        }

                        this.scratchpadText = '';
                    } catch (err) {
                        console.error(err);
                        this.parseMessage = { type: 'error', text: 'Error parsing HTML data.' };
                    }
                },
                handleOpenModal(prod = null) {
                    if (prod) {
                        this.formData = { ...prod };
                        this.editingId = prod.id;
                    } else {
                        this.formData = this.getEmptyForm();
                        this.editingId = null;
                    }
                    this.isModalOpen = true;
                },
                handleCloseModal() {
                    this.isModalOpen = false;
                    this.editingId = null;
                },
                handleSave() {
                    const prodId = this.editingId || crypto.randomUUID();
                    const newProd = { ...this.formData, id: prodId };
                    
                    if (this.editingId) {
                        this.productions = this.productions.map(p => p.id === this.editingId ? newProd : p);
                        this.logActivity('Updated', this.formData.name, 'Manually edited production details or rates.');
                    } else {
                        this.productions.push(newProd);
                        this.logActivity('Added', this.formData.name, 'Manually added new production.');
                    }
                    this.handleCloseModal();
                },
                handleDelete(id) {
                    const prodToDelete = this.productions.find(p => p.id === id);
                    if (prodToDelete) {
                        this.logActivity('Deleted', prodToDelete.name, 'Removed production from tracker.');
                    }
                    this.productions = this.productions.filter(p => p.id !== id);
                },
                getStatusColor(status) {
                    switch (status) {
                        case 'Shooting': return 'bg-emerald-500/20 text-emerald-400 border-emerald-500/50';
                        case 'Prep': return 'bg-amber-500/20 text-amber-400 border-amber-500/50';
                        case 'Upcoming': return 'bg-blue-500/20 text-blue-400 border-blue-500/50';
                        case 'Rumoured': return 'bg-purple-500/20 text-purple-400 border-purple-500/50';
                        case 'Wrapped': return 'bg-slate-500/20 text-slate-400 border-slate-500/50';
                        default: return 'bg-gray-500/20 text-gray-400 border-gray-500/50';
                    }
                }
            }
        });

        // Global Icon Component
        app.component('icon', {
            props: ['name', 'className'],
            template: `<svg :class="className" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" v-html="path"></svg>`,
            computed: {
                path() { return iconPaths[this.name] || ''; }
            }
        });

        app.mount('#app');
    </script>
</body>
</html>